<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ù‚Ø±Ø¨Ù„ÙˆÙƒÙˆ ÙØ§Ø´ÙˆÙ† | Fashion Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        neonBlue: '#00f3ff',
                        neonPink: '#bc13fe',
                        neonGreen: '#39ff14',
                        darkBg: '#050505',
                        cardBg: '#111111'
                    },
                    fontFamily: { cairo: ['Cairo', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #050505; color: #fff; -webkit-tap-highlight-color: transparent; }
        .neon-box { border: 1px solid rgba(255,255,255,0.08); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.5); transition: all 0.3s; }
        .neon-box:hover { border-color: #bc13fe; box-shadow: 0 0 15px rgba(188,19,254,0.3); }
        .custom-scrollbar::-webkit-scrollbar { height: 4px; width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #bc13fe; border-radius: 4px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* ØªØµÙ…ÙŠÙ… Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± (Radio Chips) */
        .option-input:checked + div { background: #bc13fe; color: white; border-color: #bc13fe; box-shadow: 0 0 10px #bc13fe; }
        .color-input:checked + div { border-color: #00f3ff; box-shadow: 0 0 10px #00f3ff; transform: scale(1.1); }
    </style>
</head>
<body class="pb-32 relative">

    <nav class="fixed top-0 w-full z-50 bg-black/90 backdrop-blur-xl border-b border-white/10 shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="text-2xl font-black flex items-center gap-1">
                    <span class="text-white">Ø£Ù‚Ø±Ø¨</span><span class="text-neonPink">Ù„ÙˆÙƒÙˆ</span>
                    <span class="text-[10px] text-neonBlue border border-neonBlue px-1 rounded ml-1">FASHION</span>
                </div>
                <button onclick="openTrackModal()" class="mr-2 text-[10px] font-bold text-neonBlue border border-neonBlue/30 bg-neonBlue/10 px-3 py-1.5 rounded-full flex items-center gap-1 hover:bg-neonBlue/20 transition">
                    <i class="fas fa-motorcycle"></i> ØªØªØ¨Ø¹ Ø§Ù„Ø´Ø­Ù†Ø©
                </button>
            </div>
        </div>
    </nav>

    <header class="mt-20 mb-6 px-4 text-center">
        <div class="bg-gradient-to-b from-gray-900 to-black rounded-3xl p-6 border border-gray-800 relative overflow-hidden">
            <h1 class="text-2xl md:text-3xl font-black mb-2 text-white">ÙØ§Ø´ÙˆÙ† Ø³ØªÙˆØ± <span class="text-neonBlue">Ø¹Ù„Ù‰ Ø°ÙˆÙ‚Ùƒ</span> ğŸ‘—</h1>
            <p class="text-gray-400 text-xs md:text-sm max-w-md mx-auto">Ø£Ø´ÙŠÙƒ Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯Ø§Øª.. Ù‚ÙŠØ³ ÙÙŠ Ø¨ÙŠØªÙƒ ÙˆØ§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù….</p>
        </div>
    </header>

    <section class="container mx-auto px-3 md:px-4 mb-12">
        <div class="relative mb-6">
            <input type="text" id="searchInput" onkeyup="searchProducts()" placeholder="Ø¨ØªØ¯ÙˆØ± Ø¹Ù„Ù‰ ØªÙŠØ´Ø±ØªØŒ Ø¨Ù†Ø·Ù„ÙˆÙ†ØŒ ÙØ³ØªØ§Ù†ØŸ" 
                class="w-full bg-gray-900/80 border border-gray-700 text-white rounded-2xl py-3.5 px-11 focus:border-neonBlue focus:ring-1 focus:ring-neonBlue outline-none">
            <i class="fas fa-search absolute right-4 top-4 text-gray-500"></i>
        </div>

        <div class="sticky top-[60px] z-40 bg-[#050505]/95 backdrop-blur-sm py-2 mb-2 overflow-x-auto whitespace-nowrap no-scrollbar" id="categories-container">
            </div>

        <div id="products-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-4 mb-8"></div>
    </section>

    <div id="variant-modal" class="fixed inset-0 z-[70] hidden flex items-end md:items-center justify-center sm:p-4">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity" onclick="closeVariantModal()"></div>
        <div class="bg-[#111] w-full max-w-md rounded-t-3xl md:rounded-3xl border border-white/10 relative animate-slide overflow-hidden flex flex-col max-h-[90vh] shadow-2xl">
            
            <div class="overflow-y-auto custom-scrollbar p-5 pb-24">
                <div id="modal-images" class="flex overflow-x-auto gap-2 snap-x snap-mandatory mb-4 no-scrollbar"></div>
                
                <h2 id="modal-title" class="text-2xl font-black text-white mb-1"></h2>
                <p id="modal-price" class="text-neonBlue font-bold text-xl mb-3"></p>
                <p id="modal-desc" class="text-gray-300 text-sm leading-relaxed mb-6 border-b border-gray-800 pb-4"></p>

                <div class="mb-5">
                    <p class="text-xs text-gray-400 mb-2 font-bold">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø§Ø³:</p>
                    <div id="modal-sizes" class="flex flex-wrap gap-2"></div>
                </div>

                <div class="mb-5">
                    <p class="text-xs text-gray-400 mb-2 font-bold">Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ†:</p>
                    <div id="modal-colors" class="flex flex-wrap gap-2"></div>
                </div>
            </div>

            <div class="absolute bottom-0 w-full p-4 bg-[#111] border-t border-gray-800">
                <button id="add-to-cart-btn" onclick="confirmAddToCart()" disabled class="w-full bg-gray-800 text-gray-500 font-bold py-3.5 rounded-xl transition-all shadow-lg flex items-center justify-center gap-2">
                    <span>Ø§Ø®ØªØ§Ø± Ø§Ù„Ù…Ù‚Ø§Ø³ ÙˆØ§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£ÙˆÙ„</span> <i class="fas fa-exclamation-circle"></i>
                </button>
            </div>
            
            <button onclick="closeVariantModal()" class="absolute top-4 left-4 bg-black/50 p-2 rounded-full text-white"><i class="fas fa-times"></i></button>
        </div>
    </div>

    <div class="fixed bottom-5 left-4 right-4 z-40 max-w-lg mx-auto">
        <button onclick="toggleCart()" class="w-full bg-gray-900 border border-neonPink/50 text-white rounded-2xl shadow-[0_4px_20px_rgba(188,19,254,0.3)] overflow-hidden group">
            <div class="bg-gradient-to-r from-neonPink/10 to-purple-900/20 backdrop-blur-md py-3 px-5 flex justify-between items-center h-full">
                <div class="flex items-center gap-3">
                    <div class="bg-neonPink text-white font-black w-8 h-8 rounded-lg flex items-center justify-center" id="cart-counter">0</div>
                    <span class="font-bold text-sm">Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡</span>
                </div>
                <span class="font-black text-lg text-neonBlue" id="cart-total">0 Ø¬.Ù…</span>
            </div>
        </button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp, query, where, getDocs, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyCUgMCQPD3LqQHhiJqGUykCvi4GkqIxBDg", authDomain: "akrabloko.firebaseapp.com", projectId: "akrabloko", storageBucket: "akrabloko.firebasestorage.app", messagingSenderId: "846428093028", appId: "1:846428093028:web:29f31599b90125c2673d71" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let products = [];
        let cart = JSON.parse(localStorage.getItem('akrabloko_cart')) || [];
        let selectedProduct = null;
        let selectedSize = null;
        let selectedColor = null;

        window.fetchProducts = async function() {
            // (Ù†ÙØ³ ÙƒÙˆØ¯ Ø§Ù„ÙƒØ§Ø´ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¨Ø§Ù„Ø¸Ø¨Ø·)
            const grid = document.getElementById('products-grid');
            // ... (Ø§Ø®ØªØµØ§Ø± Ø§Ù„ÙƒÙˆØ¯: ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ù„ÙˆÙƒØ§Ù„ Ø³ØªÙˆØ±ÙŠØ¬ Ø£Ùˆ ÙØ§ÙŠØ±Ø¨ÙŠØ³)
            // Ù‡Ù†ÙØªØ±Ø¶ Ø¥Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Øª:
            try {
                const q = query(collection(db, "products"), orderBy("category"));
                const snapshot = await getDocs(q);
                products = [];
                snapshot.forEach(doc => products.push({ id: doc.id, ...doc.data() }));
                renderProducts(products);
            } catch(e) { console.log(e); }
        };

        window.renderProducts = (items) => {
            const grid = document.getElementById('products-grid');
            grid.innerHTML = items.map(p => `
                <div onclick="openVariantModal('${p.id}')" class="bg-gray-900 rounded-2xl p-3 neon-box flex flex-col justify-between h-full relative overflow-hidden group cursor-pointer">
                    <div class="w-full h-56 rounded-xl bg-gray-800 mb-3 overflow-hidden relative">
                        <img src="${p.coverImage || p.icon}" class="w-full h-full object-cover group-hover:scale-110 transition duration-500">
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-100 text-sm mb-1 line-clamp-1 text-right">${p.name}</h3>
                        <p class="text-[10px] text-gray-400 line-clamp-1 mb-2">${p.desc || 'Ø®Ø§Ù…Ø© Ù…Ù…ØªØ§Ø²Ø© - Ù‚Ø·Ù† 100%'}</p>
                        <div class="flex items-center justify-between w-full mt-1">
                            <span class="text-neonBlue font-black text-lg">${p.price} <span class="text-[9px] text-gray-400">Ø¬.Ù…</span></span>
                            <div class="w-7 h-7 rounded-lg bg-gray-800 text-neonPink border border-neonPink flex items-center justify-center">
                                <i class="fas fa-plus text-xs"></i>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        };

        // --- Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø§Ù„Ø²ÙŠØªÙˆÙ†Ø©) ---
        window.openVariantModal = (pid) => {
            const p = products.find(x => x.id === pid);
            selectedProduct = p; selectedSize = null; selectedColor = null;
            
            document.getElementById('modal-title').innerText = p.name;
            document.getElementById('modal-price').innerText = p.price + ' Ø¬.Ù…';
            document.getElementById('modal-desc').innerText = p.desc || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ ØªÙØµÙŠÙ„ÙŠ.';
            
            // 1. Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± (Cover + Extra Images)
            let imgs = [p.coverImage || p.icon];
            if(p.extraImages) imgs = imgs.concat(p.extraImages); // Ù…ØµÙÙˆÙØ© Ø§Ù„ØµÙˆØ±
            
            document.getElementById('modal-images').innerHTML = imgs.map(img => `
                <img src="${img}" class="w-64 h-80 object-cover rounded-xl snap-center border border-gray-800 flex-shrink-0">
            `).join('');

            // 2. Ø±Ø³Ù… Ù…Ù‚Ø§Ø³Ø§Øª (Available Sizes)
            const sizes = p.sizes || ['One Size']; 
            document.getElementById('modal-sizes').innerHTML = sizes.map(s => `
                <label class="cursor-pointer">
                    <input type="radio" name="size_opt" value="${s}" class="option-input sr-only" onchange="selectSize('${s}')">
                    <div class="bg-gray-800 text-gray-400 border border-gray-700 px-4 py-2 rounded-lg text-sm font-bold transition hover:bg-gray-700 uppercase">${s}</div>
                </label>
            `).join('');

            // 3. Ø±Ø³Ù… Ø£Ù„ÙˆØ§Ù† (Available Colors)
            const colors = p.colors || ['Standard'];
            document.getElementById('modal-colors').innerHTML = colors.map(c => `
                <label class="cursor-pointer">
                    <input type="radio" name="color_opt" value="${c}" class="option-input color-input sr-only" onchange="selectColor('${c}')">
                    <div class="bg-gray-800 text-gray-400 border border-gray-700 px-4 py-2 rounded-lg text-sm font-bold transition hover:bg-gray-700">${c}</div>
                </label>
            `).join('');

            checkBtnState();
            document.getElementById('variant-modal').classList.remove('hidden');
        };

        window.selectSize = (s) => { selectedSize = s; checkBtnState(); }
        window.selectColor = (c) => { selectedColor = c; checkBtnState(); }

        window.checkBtnState = () => {
            const btn = document.getElementById('add-to-cart-btn');
            if(selectedSize && selectedColor) {
                btn.disabled = false;
                btn.classList.remove('bg-gray-800', 'text-gray-500');
                btn.classList.add('bg-neonPink', 'text-white');
                btn.innerHTML = `<span>Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</span> <i class="fas fa-cart-plus"></i>`;
            } else {
                btn.disabled = true;
                btn.classList.add('bg-gray-800', 'text-gray-500');
                btn.classList.remove('bg-neonPink', 'text-white');
                btn.innerHTML = `<span>Ø§Ø®ØªØ§Ø± Ø§Ù„Ù…Ù‚Ø§Ø³ ÙˆØ§Ù„Ù„ÙˆÙ†</span>`;
            }
        };

        window.confirmAddToCart = () => {
            const cartItemId = `${selectedProduct.id}-${selectedSize}-${selectedColor}`;
            const displayName = `${selectedProduct.name} (${selectedSize} - ${selectedColor})`;
            
            const exists = cart.find(i => i.cartItemId === cartItemId);
            if(exists) exists.qty++;
            else cart.push({ cartItemId, id: selectedProduct.id, name: displayName, price: selectedProduct.price, qty: 1, image: selectedProduct.coverImage });
            
            saveCart(); updateCartUI(); closeVariantModal();
        };

        // --- Ø¨Ø§Ù‚ÙŠ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ (Ù†ÙØ³ Ø§Ù„Ù‚Ø¯ÙŠÙ…) ---
        window.saveCart = () => localStorage.setItem('akrabloko_cart', JSON.stringify(cart));
        window.updateCartUI = () => { /* ... Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯ ... */ };
        window.closeVariantModal = () => document.getElementById('variant-modal').classList.add('hidden');
        
        window.addEventListener('DOMContentLoaded', () => { fetchProducts(); updateCartUI(); });
    </script>
</body>
</html>
