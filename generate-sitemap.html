<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Sitemap Generator (Smart Links)</title>
    <style>
        body { background: #111; color: #00f3ff; font-family: monospace; padding: 20px; }
        textarea { width: 100%; height: 500px; background: #222; color: #fff; border: 1px solid #444; padding: 10px; direction: ltr; }
        button { padding: 15px 30px; background: #bc13fe; color: white; border: none; cursor: pointer; margin-bottom: 10px; font-weight: bold; font-size: 16px; border-radius: 8px; }
        button:hover { opacity: 0.9; }
    </style>
</head>
<body>
    <h1>Ø£Ø¯Ø§Ø© ØªÙˆÙ„ÙŠØ¯ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø°ÙƒÙŠØ© Ù„Ù„Ø³ÙŠÙˆ) ðŸš€</h1>
    <p style="color:white">Ø§Ù„Ø£Ø¯Ø§Ø© Ø¯ÙŠ Ù‡ØªÙˆÙ„Ø¯ Ø±ÙˆØ§Ø¨Ø· Ø¨ØµÙŠØºØ© <code>/product/ID</code> Ø¹Ø´Ø§Ù† Ø¬ÙˆØ¬Ù„ ÙŠÙ‚Ø±Ø£ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØµØ­.</p>
    <button onclick="generate()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªÙˆÙ„ÙŠØ¯</button>
    <textarea id="output" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ù‡ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§..."></textarea>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyCUgMCQPD3LqQHhiJqGUykCvi4GkqIxBDg", authDomain: "akrabloko.firebaseapp.com", projectId: "akrabloko", storageBucket: "akrabloko.firebasestorage.app", messagingSenderId: "846428093028", appId: "1:846428093028:web:29f31599b90125c2673d71" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
        const BASE_URL = "https://akrabloko.vercel.app"; 

        window.generate = async () => {
            const out = document.getElementById('output');
            out.value = "Ø¬Ø§Ø±ÙŠ Ø³Ø­Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø±ÙˆØ§Ø¨Ø·...";

            try {
                let xml = `<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
    <url>
        <loc>${BASE_URL}/</loc>
        <lastmod>${new Date().toISOString().split('T')[0]}</lastmod>
        <changefreq>daily</changefreq>
        <priority>1.0</priority>
    </url>`;

                const querySnapshot = await getDocs(collection(db, "products"));
                
                querySnapshot.forEach((doc) => {
                    // Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø§Ø³ØªØ®Ø¯Ø§Ù… /product/ Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† details.html
                    xml += `
    <url>
        <loc>${BASE_URL}/product/${doc.id}</loc>
        <lastmod>${new Date().toISOString().split('T')[0]}</lastmod>
        <changefreq>daily</changefreq>
        <priority>0.8</priority>
    </url>`;
                });

                xml += `
</urlset>`;

                out.value = xml;
                alert("ØªÙ… Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø³ÙŠÙˆ.");

            } catch (error) {
                console.error(error);
                out.value = "Ø­Ø¯Ø« Ø®Ø·Ø£: " + error.message;
            }
        };
    </script>
</body>
</html>
