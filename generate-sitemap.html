<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Sitemap Generator</title>
    <style>
        body { background: #111; color: #0f0; font-family: monospace; padding: 20px; }
        textarea { width: 100%; height: 500px; background: #222; color: #fff; border: 1px solid #444; padding: 10px; }
        button { padding: 10px 20px; background: #bc13fe; color: white; border: none; cursor: pointer; margin-bottom: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Ø£Ø¯Ø§Ø© ØªÙˆÙ„ÙŠØ¯ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Sitemap XML)</h1>
    <p style="color:white">Ø§Ø¶ØºØ· Ø§Ù„Ø²Ø±Ø§Ø± ØªØ­ØªØŒ ÙˆØ§Ø³ØªÙ†Ù‰ Ø«ÙˆØ§Ù†ÙŠØŒ ÙˆØ§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù„ÙŠ Ù‡ÙŠØ¸Ù‡Ø±.</p>
    <button onclick="generate()">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªÙˆÙ„ÙŠØ¯ ğŸš€</button>
    <textarea id="output" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ù‡ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§..."></textarea>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Ù†ÙØ³ Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ø¨Ø§Ù„Ø¸Ø¨Ø·
        const firebaseConfig = { apiKey: "AIzaSyCUgMCQPD3LqQHhiJqGUykCvi4GkqIxBDg", authDomain: "akrabloko.firebaseapp.com", projectId: "akrabloko", storageBucket: "akrabloko.firebasestorage.app", messagingSenderId: "846428093028", appId: "1:846428093028:web:29f31599b90125c2673d71" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (ØªØ£ÙƒØ¯ Ø¥Ù†Ù‡ ØµØ­)
        const BASE_URL = "https://akrabloko.vercel.app"; 

        window.generate = async () => {
            const out = document.getElementById('output');
            out.value = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";

            try {
                // 1. Ø¨Ø¯Ø§ÙŠØ© Ù…Ù„Ù XML
                let xml = `<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
    <url>
        <loc>${BASE_URL}/index.html</loc>
        <lastmod>${new Date().toISOString().split('T')[0]}</lastmod>
        <changefreq>daily</changefreq>
        <priority>1.0</priority>
    </url>`;

                // 2. Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Firebase
                const querySnapshot = await getDocs(collection(db, "products"));
                
                querySnapshot.forEach((doc) => {
                    // Ù„ÙƒÙ„ Ù…Ù†ØªØ¬ØŒ Ø¨Ù†Ø¹Ù…Ù„ Ø±Ø§Ø¨Ø· Ù…Ø®ØµØµ
                    // Ù„Ø§Ø­Ø¸: details.html?id=KOOD
                    xml += `
    <url>
        <loc>${BASE_URL}/details.html?id=${doc.id}</loc>
        <lastmod>${new Date().toISOString().split('T')[0]}</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.8</priority>
    </url>`;
                });

                // 3. Ù‚ÙÙ„Ø© Ø§Ù„Ù…Ù„Ù
                xml += `
</urlset>`;

                out.value = xml;
                alert("ØªÙ… Ø§Ù„ØªÙˆÙ„ÙŠØ¯! Ø§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ø­ÙØ¸Ù‡ ÙÙŠ Ù…Ù„Ù sitemap.xml");

            } catch (error) {
                console.error(error);
                out.value = "Ø­Ø¯Ø« Ø®Ø·Ø£: " + error.message;
            }
        };
    </script>
</body>
</html>
