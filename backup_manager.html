<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ğŸ’¾</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        neonBlue: '#00f3ff', neonPink: '#bc13fe', darkBg: '#050505', cardBg: '#111111'
                    },
                    fontFamily: { cairo: ['Cairo', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body { background-color: #050505; color: white; font-family: 'Cairo', sans-serif; text-align: center; }
        .neon-card {
            background: #111; border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
        }
        .neon-card:hover { transform: translateY(-5px); }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1a1a1a; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #bc13fe; border-radius: 4px; }
        
        /* Ø³ØªØ§ÙŠÙ„ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .hidden-force { display: none !important; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center">

    <div id="login-screen" class="login-overlay">
        <div class="bg-[#111] p-8 rounded-3xl border border-gray-800 shadow-[0_0_50px_rgba(188,19,254,0.1)] w-full max-w-sm text-center relative overflow-hidden">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-neonBlue to-neonPink"></div>
            <div class="w-20 h-20 bg-gray-900 rounded-full mx-auto flex items-center justify-center mb-6 border-2 border-neonPink shadow-[0_0_15px_rgba(188,19,254,0.3)]">
                <i class="fas fa-user-secret text-4xl text-neonPink"></i>
            </div>
            <h2 class="text-2xl font-black text-white mb-2">Ù…Ù†Ø·Ù‚Ø© Ø®Ø·Ø±Ø© âš ï¸</h2>
            <p class="text-gray-500 text-xs mb-6">ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
            <form onsubmit="event.preventDefault(); login();">
                <div class="mb-4 relative">
                    <i class="fas fa-envelope absolute top-4 right-4 text-gray-500"></i>
                    <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="w-full bg-black border border-gray-800 rounded-xl py-3 pr-10 pl-3 text-white focus:border-neonBlue outline-none transition text-sm">
                </div>
                <div class="mb-6 relative">
                    <i class="fas fa-lock absolute top-4 right-4 text-gray-500"></i>
                    <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full bg-black border border-gray-800 rounded-xl py-3 pr-10 pl-3 text-white focus:border-neonBlue outline-none transition text-sm">
                </div>
                <button type="submit" id="login-btn" class="w-full bg-gradient-to-r from-neonPink to-purple-900 hover:from-purple-800 hover:to-neonPink text-white font-bold py-3.5 rounded-xl shadow-lg transition transform active:scale-95 flex justify-center items-center gap-2">
                    <span>ÙØªØ­ Ø§Ù„Ø®Ø²Ù†Ø©</span> <i class="fas fa-unlock"></i>
                </button>
            </form>
            <p id="login-error" class="text-red-500 text-xs mt-4 font-bold bg-red-900/10 py-2 rounded border border-red-900/30 hidden"><i class="fas fa-exclamation-circle"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©</p>
        </div>
    </div>

    <div id="dashboard-screen" class="hidden-force max-w-5xl w-full p-5">
        <h1 class="text-4xl font-black mb-2 text-white"><i class="fas fa-database text-neonBlue"></i> ØºØ±ÙØ© Ø§Ù„ØªØ­ÙƒÙ… <span class="text-neonPink">ÙˆØ§Ù„Ø£Ù…Ø§Ù†</span></h1>
        <p class="text-gray-400 mb-10">ØªØ­ÙƒÙ… ÙƒØ§Ù…Ù„ ÙÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†ØªØ¬Ø§ØªÙƒ: Ø­ÙØ¸ØŒ Ø­Ø°ÙØŒ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø©.</p>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            
            <div class="neon-card p-6 rounded-3xl border hover:border-green-500 hover:shadow-[0_0_20px_rgba(34,197,94,0.2)] group">
                <div class="w-16 h-16 bg-green-500/10 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-green-500/20 transition">
                    <i class="fas fa-download text-3xl text-green-500"></i>
                </div>
                <h2 class="text-xl font-bold mb-2">1. ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø© (Backup)</h2>
                <p class="text-xs text-gray-400 mb-4">Ù†Ø²Ù„ ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ù…Ù„Ù Ø¹Ù†Ø¯Ùƒ Ù„Ù„Ø£Ù…Ø§Ù†.</p>
                <button onclick="downloadBackup()" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-xl transition">
                    ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù ğŸ“¥
                </button>
            </div>

            <div class="neon-card p-6 rounded-3xl border hover:border-red-500 hover:shadow-[0_0_20px_rgba(239,68,68,0.2)] group">
                <div class="w-16 h-16 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-red-500/20 transition">
                    <i class="fas fa-trash-alt text-3xl text-red-500"></i>
                </div>
                <h2 class="text-xl font-bold mb-2">2. ÙÙˆØ±Ù…Ø§Øª (Ø­Ø°Ù Ø§Ù„ÙƒÙ„)</h2>
                <p class="text-xs text-gray-400 mb-4">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹.</p>
                <button onclick="deleteAll()" class="w-full bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded-xl transition">
                    Ø­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ğŸ—‘ï¸
                </button>
            </div>

            <div class="neon-card p-6 rounded-3xl border hover:border-neonBlue hover:shadow-[0_0_20px_rgba(0,243,255,0.2)] group">
                <div class="w-16 h-16 bg-neonBlue/10 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-neonBlue/20 transition">
                    <i class="fas fa-cloud-upload-alt text-3xl text-neonBlue"></i>
                </div>
                <h2 class="text-xl font-bold mb-2">3. Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ù†Ø³Ø®Ø©</h2>
                <p class="text-xs text-gray-400 mb-4">Ø§Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù„ÙŠ Ø­Ù…Ù„ØªÙ‡ Ø¹Ø´Ø§Ù† ØªØ±Ø¬Ø¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª.</p>
                <label class="w-full bg-neonBlue hover:bg-cyan-400 text-black font-bold py-3 rounded-xl transition cursor-pointer block">
                    <span>Ø§Ø®ØªØ± Ù…Ù„Ù ÙˆØ±ÙØ¹ ğŸ“¤</span>
                    <input type="file" id="fileInput" accept=".json" class="hidden" onchange="uploadBackup(this)">
                </label>
            </div>

        </div>

        <div class="bg-[#111] border border-gray-800 rounded-3xl p-1 text-right">
            <div class="bg-black/50 p-3 rounded-t-3xl border-b border-gray-800 flex justify-between px-6">
                <span class="text-gray-400"><i class="fas fa-terminal"></i> Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</span>
                <button onclick="logout()" class="text-red-500 text-xs border border-red-900 px-3 py-1 rounded hover:bg-red-900/20">Ø®Ø±ÙˆØ¬</button>
            </div>
            <div id="console" class="h-48 overflow-y-auto p-4 custom-scrollbar text-sm space-y-2 font-mono text-gray-300">
                <div class="opacity-50">> ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹...</div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, addDoc, writeBatch, serverTimestamp, query } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCUgMCQPD3LqQHhiJqGUykCvi4GkqIxBDg",
            authDomain: "akrabloko.firebaseapp.com",
            projectId: "akrabloko",
            storageBucket: "akrabloko.firebasestorage.app",
            messagingSenderId: "846428093028",
            appId: "1:846428093028:web:29f31599b90125c2673d71",
            measurementId: "G-31SP9TP2N1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const consoleDiv = document.getElementById('console');

        // --- Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('login-screen').classList.add('hidden-force');
                document.getElementById('dashboard-screen').classList.remove('hidden-force');
                log("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­. Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ø¯ÙŠØ±.", "success");
            } else {
                document.getElementById('login-screen').classList.remove('hidden-force');
                document.getElementById('dashboard-screen').classList.add('hidden-force');
            }
        });

        window.login = () => {
            const email = document.getElementById('email').value.trim();
            const pass = document.getElementById('password').value.trim();
            const btn = document.getElementById('login-btn');
            
            if (!email || !pass) return;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
            
            signInWithEmailAndPassword(auth, email, pass)
                .catch((error) => {
                    document.getElementById('login-error').classList.remove('hidden');
                    btn.innerHTML = '<span>ÙØªØ­ Ø§Ù„Ø®Ø²Ù†Ø©</span> <i class="fas fa-unlock"></i>';
                });
        };

        window.logout = () => signOut(auth);

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ø£Ø¯Ø§Ø© ---
        function log(msg, type = 'info') {
            const colors = { info: 'text-gray-300', success: 'text-green-400', error: 'text-red-500', warn: 'text-yellow-400' };
            const time = new Date().toLocaleTimeString('en-US', {hour12: false});
            consoleDiv.innerHTML += `<div class="${colors[type]} border-b border-white/5 pb-1">[${time}] ${msg}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        window.downloadBackup = async () => {
            log("â³ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...");
            try {
                const q = query(collection(db, "products"));
                const snapshot = await getDocs(q);
                if (snapshot.empty) return log("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª!", "error");

                const products = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    delete data.createdAt; 
                    products.push(data);
                });

                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(products));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                const fileName = `backup_akrabloko_${new Date().toISOString().split('T')[0]}.json`;
                downloadAnchorNode.setAttribute("download", fileName);
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();

                log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ù†Ø³Ø®Ø© (${products.length} Ù…Ù†ØªØ¬).`, "success");
            } catch (e) {
                log("âŒ Ø®Ø·Ø£: " + e.message, "error");
            }
        };

        window.deleteAll = async () => {
            if(!confirm("âš ï¸ ØªØ­Ø°ÙŠØ±!\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŸ")) return;
            log("â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...", "warn");
            try {
                const q = query(collection(db, "products"));
                const snapshot = await getDocs(q);
                if (snapshot.empty) return log("â„¹ï¸ Ø§Ù„Ù…Ø®Ø²Ù† ÙØ§Ø±Øº.", "info");

                const batch = writeBatch(db);
                let count = 0;
                snapshot.forEach((doc) => {
                    batch.delete(doc.ref);
                    count++;
                });
                await batch.commit();
                log(`ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù ${count} Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­.`, "success");
            } catch (e) {
                log("âŒ ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: " + e.message, "error");
            }
        };

        window.uploadBackup = async (input) => {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const products = JSON.parse(e.target.result);
                    if (!Array.isArray(products)) throw new Error("Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­");
                    if(!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø±ÙØ¹ ${products.length} Ù…Ù†ØªØ¬ØŸ`)) return;

                    log(`â³ Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ ${products.length} Ù…Ù†ØªØ¬...`);
                    let count = 0;
                    const batchSize = 10;
                    for (let i = 0; i < products.length; i += batchSize) {
                        const chunk = products.slice(i, i + batchSize);
                        await Promise.all(chunk.map(async (p) => {
                            await addDoc(collection(db, "products"), { ...p, createdAt: serverTimestamp() });
                            count++;
                        }));
                        log(`... ØªÙ… Ø±ÙØ¹ ${count}`, "info");
                    }
                    log(`ğŸ‰ ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© ${count} Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­!`, "success");
                    input.value = '';
                } catch (err) {
                    log("âŒ Ù…Ù„Ù ØªØ§Ù„Ù: " + err.message, "error");
                }
            };
            reader.readAsText(file);
        };
    </script>
</body>
</html>
